package oodms.admin;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Font;
import oodms.oop.Create3DArray;
import org.jfree.chart.ChartFactory;
import org.jfree.chart.ChartPanel;
import org.jfree.chart.JFreeChart;
import org.jfree.chart.axis.CategoryAxis;
import org.jfree.chart.axis.ValueAxis;
import org.jfree.chart.plot.CategoryPlot;
import org.jfree.chart.plot.PlotOrientation;
import org.jfree.chart.renderer.category.BarRenderer;
import org.jfree.chart.title.TextTitle;
import org.jfree.data.category.DefaultCategoryDataset;
import org.jfree.ui.RectangleInsets;

public class AgeReport extends javax.swing.JFrame {

    /**
     * Creates new form GenderReport
     */
    public AgeReport() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        targetPanel = new javax.swing.JPanel();
        returnBtn = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Age Report");
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowOpened(java.awt.event.WindowEvent evt) {
                formWindowOpened(evt);
            }
        });

        targetPanel.setBackground(new java.awt.Color(184, 145, 104));

        javax.swing.GroupLayout targetPanelLayout = new javax.swing.GroupLayout(targetPanel);
        targetPanel.setLayout(targetPanelLayout);
        targetPanelLayout.setHorizontalGroup(
            targetPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 800, Short.MAX_VALUE)
        );
        targetPanelLayout.setVerticalGroup(
            targetPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 600, Short.MAX_VALUE)
        );

        returnBtn.setBackground(new java.awt.Color(184, 145, 104));
        returnBtn.setFont(new java.awt.Font("Montserrat", 1, 14)); // NOI18N
        returnBtn.setForeground(new java.awt.Color(76, 43, 24));
        returnBtn.setText("Return");
        returnBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                returnBtnActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(targetPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(returnBtn)
                .addGap(24, 24, 24))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(targetPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(returnBtn)
                .addGap(0, 13, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void formWindowOpened(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowOpened
        // Age Distribution
        String[] ageDistribution = new String[] {"0-15", "16-30", "31-45", "46-60", "60++"};

        int[] countAgeDistribution = new int[5];
        
        // Loop only age
        String[][] countAge = new Create3DArray().create3D("/oodms/database/credentials.txt");
        
        int[] ageArr = new int[countAge.length];
        
        for(int i = 0; i < countAge.length; i++) {
            ageArr[i] = Integer.parseInt(countAge[i][5]);
        }
        
        // Count number of users depends on age group
        for(int age : ageArr) {
            if(age <= 15) {
                countAgeDistribution[0]++;
            } else if(age <= 30) {
                countAgeDistribution[1]++;
            } else if(age <= 45) {
                countAgeDistribution[2]++;
            } else if(age <= 60) {
                countAgeDistribution[3]++;
            } else {
                countAgeDistribution[4]++;
            }
        }
        
        /**
         * Generate the Pie Chart
         */
        // Create dataset
        DefaultCategoryDataset dataset = new DefaultCategoryDataset();
        for(int i = 0; i < ageDistribution.length; i++) {
            dataset.addValue(countAgeDistribution[i], "Age Group", ageDistribution[i]);
        }

        // Create pie chart
        JFreeChart chart = ChartFactory.createBarChart(
            "Age Distribution in Speed Parcel", // chart title
            "Age Group", // x axis label
            "Count", // y axis label
            dataset, // data
            PlotOrientation.VERTICAL, // orientation
            false, // include legend
            true, // tooltips
            false // urls
        );
        
        ChartPanel chartPanel = new ChartPanel(chart);
        
        // Set background color
        Color brown = new Color(184,145,104);
        chartPanel.setBackground(brown);
        chartPanel.setPreferredSize(new Dimension(500, 300));       

        // Set the font for the chart title
        Font titleFont = new Font("Montserrat", Font.BOLD, 24);
        TextTitle title = chart.getTitle();
        title.setFont(titleFont);
        
        // Set the margin for the chart title 
        title.setMargin(50, 50, 0, 50);
        
        // Set the font for the pie section labels
        Font labelFont = new Font("Karla", Font.PLAIN, 14);

        CategoryPlot plot = chart.getCategoryPlot();
        
        // Set label font
        CategoryAxis xAxis = plot.getDomainAxis();
        ValueAxis yAxis = plot.getRangeAxis();
        
        xAxis.setTickLabelFont(labelFont);
        yAxis.setTickLabelFont(labelFont);
        
        BarRenderer renderer = new BarRenderer();
        
        // Set bar color
        renderer.setSeriesPaint(0, new Color(76,43,24)); 
        
        plot.setRenderer(renderer);
        plot.setInsets(new RectangleInsets(50, 50, 50, 50)); 

        // Change to BorderLayout because the library can't work on default FlowLayout
        targetPanel.setLayout(new BorderLayout());
        targetPanel.add(chartPanel);
        
        // Update the panel display
        targetPanel.revalidate();
        targetPanel.repaint();
    }//GEN-LAST:event_formWindowOpened

    private void returnBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_returnBtnActionPerformed
        new AdminDashboard().setVisible(true);
        dispose();
    }//GEN-LAST:event_returnBtnActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(AgeReport.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(AgeReport.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(AgeReport.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(AgeReport.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new AgeReport().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton backBtn;
    private javax.swing.JButton backBtn1;
    private javax.swing.JButton returnBtn;
    private javax.swing.JPanel targetPanel;
    // End of variables declaration//GEN-END:variables
}
